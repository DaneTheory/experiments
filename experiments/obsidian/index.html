<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<title>obsidian by xplsv</title>
		<style>
			* {
				box-sizing: border-box;
			}
			body {
				background-color: #fff;
				color: #888;
				font-family: Helvetica;
				line-height: 26px;
				margin: 0px;
				overflow: hidden;
			}
			h1 {
				color: #fff;
				margin: 8px;
			}

			a {
				color: #48f;
				text-decoration: none;
			}

			a:hover {
				color: #fff;
			}

			button {
				color: #000000;
				border: 0px;
				background-color: #48f;
				padding: 5px 15px;
				font-size: 18px;
				cursor: pointer;
			}

			button:hover {
				background-color: #fff;
			}

			#info {
				position: absolute;
				width: 360px;
				height: 300px;
				left: calc(50% - 180px);
				top: calc(50% - 150px);
				text-align: center;
			}
			audio {
				position: fixed;
				left: 0;
				right: 0;
				width: 100%;
				bottom: 0;
				margin: 0;
			}
		</style>
	</head>
	<body>
		<script src="js/Frame.js"></script>

		<script src="js/libs/raf.min.js"></script>
		<script src="js/libs/three.min.js"></script>
		<script src="js/libs/calctools.js"></script>

		<script src="js/modules/WebGLRendererModule.js"></script>
		<script src="js/modules/ClearModule.js"></script>
		<script src="js/modules/FadeInModule.js"></script>

		<script src="js/modules/Torus.js"></script>
		<script src="js/modules/Torus2.js"></script>
		<script src="js/modules/Creation.js"></script>
		<script src="js/modules/City.js"></script>

		<script src="files/fonts/helvetiker_regular.typeface.js"></script>

		<script>

			var json = {
    "metadata": {
        "version": 1
    },
    "timeline": [
        [0, 0, 242, "WebGLRendererModule", {
            "width": 1280,
            "height": 720,
            "dom": null
        }],
        [3, 0, 1.8, "Torus", {
            "cameraStartPosition": [50, 250, 50],
            "cameraEndPosition": [55, 250, 55],
            "torusStartScale": [0, 0, 0],
            "torusEndScale": [0, 0, 0]
        }],
        [3, 1.800, 8.65-1.8, "Torus", {
            "cameraStartPosition": [55, 135, 55],
            "cameraEndPosition": [-55, 135, 55],
            "torusStartScale": [0, 0, 0],
            "torusEndScale": [3, 3, 3]
        }],
        [3, 8.65, 15.45-8.65, "Torus2", {
            "cameraStartPosition": [50, 150, 50],
            "cameraEndPosition": [60, 150, 50],
            "torusStartScale": [3, 3, 3],
            "torusEndScale": [3, 3, 3]
        }],
        [3, 15.45, 22.20-15.45, "Torus2", {
            "cameraStartPosition": [100, 200, 100],
            "cameraEndPosition": [-100, 200, 100],
            "torusStartScale": [3, 3, 3],
            "torusEndScale": [6, 6, 6]
        }],
        [3, 22.20, 29.27-22.20, "Torus2", {
            "cameraStartPosition": [10, 135, 10],
            "cameraEndPosition": [10, 160, 10],
            "torusStartScale": [6, 6, 6],
            "torusEndScale": [6, 6, 6]
        }],
        [3, 29.27, 36.180-29.27, "City", {
            "cameraStartPosition": [10, 135, 10],
            "cameraEndPosition": [10, 160, 10],
            "torusStartScale": [6, 6, 6],
            "torusEndScale": [6, 6, 6]
        }],
		[3, 36.180, 43-36.180, "City", {
            "cameraStartPosition": [10, 135, 10],
            "cameraEndPosition": [10, 160, 10],
            "torusStartScale": [6, 6, 6],
            "torusEndScale": [6, 6, 6]
        }],
        [3, 43, 49.85-43, "City", {
            "cameraStartPosition": [100, 65, 100],
            "cameraEndPosition": [140, 75, 200],
            "torusStartScale": [6, 6, 6],
            "torusEndScale": [6, 6, 6]
        }],
        [3, 49.85, 70.39-49.85, "City", { 
            "cameraStartPosition": [100, 65, 100],
            "cameraEndPosition": [140, 75, 200],
            "torusStartScale": [6, 6, 6],
            "torusEndScale": [6, 6, 6]
        }],
        [3, 70.39, 115.08-70.39, "City", {
            "cameraStartPosition": [100, 65, 100],
            "cameraEndPosition": [140, 75, 200],
            "torusStartScale": [6, 6, 6],
            "torusEndScale": [6, 6, 6]
        }],
        [3, 115.08, 128.78-115.08, "City", {
            "cameraStartPosition": [10, 135, 10],
            "cameraEndPosition": [10, 160, 10],
            "torusStartScale": [6, 6, 6],
            "torusEndScale": [6, 6, 6]
        }],
        [3, 128.78, 135.58-128.78, "Torus2", {
            "cameraStartPosition": [10, 135, 10],
            "cameraEndPosition": [10, 160, 10],
            "torusStartScale": [6, 6, 6],
            "torusEndScale": [6, 6, 6]
        }],
        [3, 135.58, 142.43-135.58, "Torus", {
            "cameraStartPosition": [10, 135, 10],
            "cameraEndPosition": [10, 160, 10],
            "torusStartScale": [6, 6, 6],
            "torusEndScale": [6, 6, 6]
        }],
        [3, 142.43, 149.30-142.43, "Torus", {
            "cameraStartPosition": [10, 135, 10],
            "cameraEndPosition": [10, 160, 10],
            "torusStartScale": [6, 6, 6],
            "torusEndScale": [6, 6, 6]
        }],
        [3, 149.30, 156.10-149.30, "Torus", {
            "cameraStartPosition": [10, 135, 10],
            "cameraEndPosition": [10, 160, 10],
            "torusStartScale": [6, 6, 6],
            "torusEndScale": [6, 6, 6]
        }],
        [3, 156.10, 163-156.10, "Torus", {
            "cameraStartPosition": [10, 135, 10],
            "cameraEndPosition": [10, 160, 10],
            "torusStartScale": [6, 6, 6],
            "torusEndScale": [6, 6, 6]
        }],
        [3, 163, 242-163, "Torus", {
            "cameraStartPosition": [10, 135, 10],
            "cameraEndPosition": [10, 160, 10],
            "torusStartScale": [6, 6, 6],
            "torusEndScale": [6, 6, 6]
        }],                
        /*[3, 8.65, 242-8.65, "Creation", {
            "cameraStartPosition": [10, 10, 10],
            "cameraEndPosition": [-10, 10, 10],
            "seedStartPosition": [0, 100, 0],
            "seedEndPosition": [0, 6, 0]
        }],*/
        /*[2, 0, 242, "Stardome", {
            "cameraStartPosition": [100, 100, 100],
            "cameraEndPosition": [-100, 100, 100],
        }],*/        
        [1, 0, 242, "ClearModule", {}],
        [4, 0, 1.750, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],
        [4, 1.800, 1, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],
        [4, 8.65, 1, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],
        [4, 15.45, 1, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],
        [4, 22.20, 1, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],
        [4, 29.27, 1, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],      
        [4, 36.180, 1, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],
        [4, 43, 1, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],
        [4, 49.85, 1, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],
        [4, 70.39, 1, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],
        [4, 115.08, 1, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],
        [4, 128.78, 1, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],
        [4, 135.58, 1, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],
        [4, 142.43, 1, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],
        [4, 149.30, 1, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],
        [4, 156.10, 1, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],
        [4, 163, 1, "FadeInModule", {
            "color": 0xffffff,
            "opacity": 1
        }],
        /*[3, 83.4942100076729, 3.50356830892993, "TextModule", {
            "text": "coding / mr.doob x three.js",
            "startPosition": [0, 0, 40],
            "endPosition": [0, 0, 35]
        }],
        [3, 87.04752956038395, 3.3543145775866465, "TextModule", {
            "text": "direction / trace",
            "startPosition": [0, 0, 40],
            "endPosition": [0, 0, 35]
        }],
        [3, 90.45159538175169, 3.4289414432582883, "TextModule", {
            "text": "music / om unit x lorn",
            "startPosition": [0, 0, 40],
            "endPosition": [0, 0, 35]
        }],
        [3, 93.93028806879107, 3.478692687039383, "TextModule", {
            "text": "for euskal 2013",
            "startPosition": [0, 0, 40],
            "endPosition": [0, 0, 35]
        }],
        [3, 97.40898075583046, 14.044730422888431, "TextModule", {
            "text": "OBSIDIAN",
            "startPosition": [0, 0, 20],
            "endPosition": [0, 0, 7]
        }]*/
    ],
    "curves": []
};

			var timeline = new FRAME.Timeline();

			var modules = {};

			for ( var i = 0, l = json.timeline.length; i < l; i ++ ) {

				var data = json.timeline[ i ];

				var layer = data[ 0 ];
				var start = data[ 1 ];
				var duration = data[ 2 ];
				var moduleName = data[ 3 ];
				var parameters = data[ 4 ];

				if ( window[ moduleName ] === undefined ) {

					console.log( 'FRAME: Missing module: ' + moduleName );
					continue;

				}

				var module;

				if ( modules[ moduleName ] === undefined ) {

					module = new window[ moduleName ];
					module.name = moduleName;

					modules[ moduleName ] = module;

				} else {

					module = modules[ moduleName ];

				}

				for ( var key in parameters ) {

					if ( module.parameters.input[ key ] === undefined ) {

						console.log( 'FRAME: [' + moduleName + '] doesn\'t support "' + key + '" as input parameter' );
						delete parameters[ key ];
						continue;

					}

				}

				if ( parameters.dom !== undefined ) {

					parameters.dom = document.body;

				}

				var element = new FRAME.TimelineElement( moduleName, layer, start, duration, module, parameters );

				timeline.add( element );

			}

			var audio = document.createElement( 'audio' );
			audio.controls = true;
			audio.style.display = 'none';
			audio.style.transition = 'opacity 1s';
			document.body.appendChild( audio );

			var source = document.createElement( 'source' );
			source.src = 'files/this.ogg';
			source.type = 'audio/ogg';
			audio.appendChild( source );

			var source = document.createElement( 'source' );
			source.src = 'files/this.mp3';
			source.type = 'audio/mpeg';
			audio.appendChild( source );

			var timeoutID;

			var showControls = function ( event ) {

				audio.style.opacity = 0.5;

				if ( timeoutID !== undefined ) {

					clearTimeout( timeoutID );

				}

				timeoutID = setTimeout( function () {

					audio.style.opacity = 0;

				}, 1000 );

			};

			document.addEventListener( 'mousemove', showControls );
			document.addEventListener( 'touchstart', showControls );

			var animate = function () {

				if ( audio.duration > 0 && audio.currentTime === audio.duration ) {

					audio.style.display = 'none';

					var info = document.getElementById( 'info' );
					info.style.display = '';

					return;

				}
				//console.log(audio.currentTime);
				requestAnimationFrame( animate );
				timeline.update( audio.currentTime );

			};

			var start = function () {

				audio.style.display = '';

				var info = document.getElementById( 'info' );
				info.style.display = 'none';

				audio.play();
				animate();

			};

		</script>
		<div id="info">

			<h1></h1>
			A Three.js/WebGL Demo

			<br /><br />

			Code: <a href="http://www.luigimannoni.com/" target="_blank">MacK</a><br />
			Music: <a href="https://soundcloud.com/omunit" target="_blank">om unit</a> x <a href="https://soundcloud.com/lorn" target="_blank">lorn</a>

			<br /><br />

			<a href="https://github.com/xplsv/obsidian" target="_blank">source code</a>, <a href="http://www.youtube.com/watch?v=sW_fel34VK4" target="_blank">video</a>

			<br /><br />

			<button onclick="javascript:start()">start</button>

		</div>
	</body>
</html>
